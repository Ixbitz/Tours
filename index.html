<head>
  <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSlX2Yz056seqJJ-c3cnzHHWap8SlV8NQ&loading=async&callback=initMap"></script>
  <script>
    async function parseTour(url) {
      const routeXml = await (await fetch(url)).text();
      const parser = new DOMParser();
      const route = parser.parseFromString(routeXml, 'text/xml');
      return Array.from(route.querySelectorAll('trk > trkseg > trkpt')).map(point => {
        return { lng: +point.getAttribute('lon'), lat: +point.getAttribute('lat') };
      });
    }

    window.initMap = async function() {
      const { AdvancedMarkerElement, PinElement } = await google.maps.importLibrary("marker");
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 8,
        center: { lat: 52.092, lng: 5.104 },
        mapTypeId: "terrain",
        mapId: '4504f8b37365c3d0'
      });

      async function loadGpxToGmaps(file, color = '#FF0000') {
        const path = (await parseTour(file))
        new google.maps.Polyline({
          path,
          geodesic: true,
          strokeColor: color,
          strokeOpacity: 1.0,
          strokeWeight: 2,
        }).setMap(map);
        new AdvancedMarkerElement({
          map,
          position: path[0],
          title: /src\/(?<tourname>.*)\.gpx/.exec(file).groups.tourname,
          content: new PinElement({
            glyph: "'" + /src\/20(?<shortyear>\d{2})/.exec(file).groups.shortyear,
            glyphColor: "white",
          }).element
        });
      }
      await loadGpxToGmaps('src/2024-09 Z-ZX Club Noordpolderzijl - 2.gpx');
      await loadGpxToGmaps('src/2024-09 Z-ZX Club Noordpolderzijl - 1.gpx');
      await loadGpxToGmaps('src/2022-04 Z-ZX Club Bloesemrit.gpx');
      await loadGpxToGmaps('src/2021-08 Japrun.gpx');
      await loadGpxToGmaps('src/2022-09 Z-ZX Club Zuid-Holland.gpx');
      await loadGpxToGmaps('src/2022-10 Z-ZX Club Coevorden.gpx');
      await loadGpxToGmaps('src/2022-05_Z-ZX_Club_Dongen.gpx');
      await loadGpxToGmaps('src/2022-06_Z-ZX_Club_Kersenrit_Beneden_Leeuwen.gpx', '#0000FF');
      await loadGpxToGmaps('src/2023-06 Z-ZX Club Lottum.gpx');
      await loadGpxToGmaps('src/2021-07 Belgium Z Owners route 2.gpx');
      await loadGpxToGmaps('src/2021-07 Belgium Z Owners route 1.gpx');
      await loadGpxToGmaps('src/2024-04 Z-ZX Club Tulpenrit.gpx');
      await loadGpxToGmaps('src/2023-09 Z-ZX Club kastelentocht zondag.gpx');
      await loadGpxToGmaps('src/2023-09 Z-ZX Club kastelentocht.gpx');
    }
  </script>
  <style>
    #map {
      flex: 1;
    }
    body {
      display: flex;
      flex-direction: row;
    }
  </style>
</head>
<body>
  <div id="map"></div>
</body>